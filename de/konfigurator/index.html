<!doctype html>
<html lang="de">
<head>
  <link rel="stylesheet" href="/assets/css/style.css">
  <link rel="stylesheet" href="/assets/css/configurator.css">

  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <!-- SEO -->
  <title>Verlags-Konfigurator | DVAYD Publishing</title>
  <meta name="description" content="Stelle dein individuelles Verlags-Paket zusammen und sende eine unverbindliche Terminanfrage an DVAYD Publishing." />

  <!-- Canonical -->
  <link rel="canonical" href="https://www.dvayd.com/de/konfigurator/" />

  <!-- Open Graph -->
  <meta property="og:title" content="Verlags-Konfigurator | DVAYD Publishing">
  <meta property="og:description" content="Konfiguriere dein Buch-Projekt und frage einen Termin bei DVAYD Publishing an.">
  <meta property="og:type" content="website">
  <meta property="og:url" content="https://www.dvayd.com/de/konfigurator/">
  <meta property="og:image" content="https://www.dvayd.com/assets/images/og-konfigurator.jpg">

  <!-- Favicon (nur EINMAL) -->
  <link rel="icon" type="image/png" href="/assets/images/favicon.png">
  <link rel="apple-touch-icon" href="/assets/images/favicon.png">


  <!-- Header / Footer Injection -->
  <script src="/js/header.js" defer></script>
  <script src="/js/footer.js" defer></script>


</head>

<body>
  <header id="site-header"></header>

  <main class="wrap">
    <div class="page-head">
      <div>
        <h1 class="page-title">Verlags-Konfigurator</h1>
        <p class="page-sub">
          Wähle pro Kategorie eine Option. Danach klickst du auf <b>„Termin anfragen“</b> –
          das Formular wird per <b>Netlify Forms</b> an deine E-Mail gesendet.
        </p>
      </div>

      <div class="tabs" aria-label="Pakete">
        <button class="tab active" type="button" data-pkg="starter">Basic Package</button>
        <button class="tab" type="button" data-pkg="plus">Print & eBook</button>
        <button class="tab" type="button" data-pkg="deluxe">Premium</button>
        <button class="tab" type="button" data-pkg="eutr">EU–TR Dual</button>
      </div>
    </div>

    <section class="chart-shell" aria-label="Prognose">
      <div class="chart-card">
        <div class="chart-head">
          <div>
            <div class="chart-kicker">Prognose</div>
            <h2 class="chart-title">Projektierte Verkaufszahlen (12 Monate)</h2>
            <p class="chart-sub">Beispielhafte Modellkurven – je nach Paket variiert die erwartete Reichweite (ohne Garantie).</p>
          </div>

          <div class="chart-metrics">
            <div class="metric">
              <div class="metric-label">Paket</div>
              <div class="metric-value" id="chartPkg">Starter</div>
            </div>
            <div class="metric">
              <div class="metric-label">Prognose (12M)</div>
              <div class="metric-value" id="chartTotal">—</div>
            </div>
          </div>
        </div>

        <div class="chart-frame">
          <svg id="projChart" viewBox="0 0 900 260" preserveAspectRatio="none" role="img" aria-label="Prognose Chart">
            <g id="grid"></g>
            <path id="area" d="" fill="rgba(37,99,235,.14)"></path>
            <path id="line" d="" fill="none" stroke="rgba(37,99,235,.95)" stroke-width="3.5" stroke-linecap="round"></path>
            <g id="dots"></g>
          </svg>

          <div class="chart-x">
            <span>Monat 1</span><span>Monat 3</span><span>Monat 6</span><span>Monat 9</span><span>Monat 12</span>
          </div>
        </div>
      </div>
    </section>
 
    <section class="layout">
      <!-- LEFT -->
      <aside class="left-panel">
        <div class="left-title">Kategorien</div>
        <div class="cat-list" id="catList"></div>
      </aside>

      <!-- CENTER -->
      <section class="center-panel">
        <div class="center-head">
          <h2 id="activeCatTitle">Kategorie</h2>
          <div class="hint">Click to select (1 Auswahl)</div>
        </div>
        <div class="options" id="activeOptions"></div>
      </section>

      <!-- MOBILE -->
      <section class="mobile-accordion" id="mobileAccordion" aria-label="Kategorien (Mobile)"></section>

      <!-- RIGHT SUMMARY -->
      <aside class="summary">
        <!-- Package Switch -->
       <div class="ps-head">
  <h3>Paket wählen (Schnellauswahl)</h3>

  <div class="ps-actions">
    <button class="ps-reset" type="button" id="resetBtnTop">Reset</button>
    <button class="ps-reset danger" type="button" id="clearAllBtnTop">Alles löschen</button>
  </div>
</div>


          <div class="ps-tabs">
            <button class="ps-tab active" type="button" data-pkg="starter">Starter</button>
            <button class="ps-tab" type="button" data-pkg="plus">Plus</button>
            <button class="ps-tab" type="button" data-pkg="deluxe">Deluxe</button>
            <button class="ps-tab" type="button" data-pkg="eutr">EU–TR</button>
          </div>
        </div>

        <div class="sum-head">
          <h3>Package Summary</h3>
          <div class="sum-badge"><span style="color:var(--success)">✓</span> Auswahl gespeichert</div>
        </div>

        <div class="sum-list" id="summaryList">
          <div class="empty" id="emptyState">Noch keine Auswahl – wähle links eine Kategorie.</div>
        </div>

        <div class="total">
          <span>Geschätzter Preis:</span>
          <span id="totalPrice">0 €</span>
        </div>

        <div class="btn-row">
          <button class="btn ghost" type="button" id="resetBtn">Reset</button>
          <button class="btn primary" type="button" id="bookBtn">Termin anfragen</button>
        </div>
      </aside>
    </section>
  </main>

  <!-- MODAL -->
  <div class="modal" id="modal" aria-hidden="true">
    <div class="modal-card" role="dialog" aria-modal="true" aria-label="Termin anfragen">
      <div class="modal-head">
        <strong>Termin anfragen</strong>
        <button class="modal-close" type="button" id="closeModal">Schließen</button>
      </div>
      <div class="modal-body">
        <form name="terminanfrage" method="POST" data-netlify="true" netlify-honeypot="bot-field">
          <input type="hidden" name="form-name" value="terminanfrage" />
          <p style="display:none">
            <label>Don’t fill this out: <input name="bot-field" /></label>
          </p>

          <div class="grid">
            <div class="field">
              <label for="name">Name</label>
              <input id="name" name="name" required placeholder="Vor- und Nachname" />
            </div>
            <div class="field">
              <label for="email">E-Mail</label>
              <input id="email" name="email" type="email" required placeholder="name@mail.com" />
            </div>
            <div class="field">
              <label for="phone">Telefon (optional)</label>
              <input id="phone" name="phone" placeholder="+49 ..." />
            </div>
            <div class="field">
              <label for="when">Wunschtermin</label>
              <input id="when" name="wunschtermin" required placeholder="z.B. Mo 18:00 oder 2–3 Slots" />
            </div>
          </div>

          <div class="field" style="margin-top:10px">
            <label for="notes">Nachricht / Kurzbeschreibung</label>
            <textarea id="notes" name="nachricht" placeholder="Worum geht es? Genre, Umfang, Ziel, Deadline …"></textarea>
          </div>

          <input type="hidden" name="paket_konfiguration" id="configField" value="" />
          <input type="hidden" name="preis_schaetzung" id="priceField" value="" />

          <div class="modal-actions">
            <button class="btn ghost" type="button" id="cancelBtn">Abbrechen</button>
            <button class="btn primary" type="submit">Anfrage senden</button>
          </div>

          <div class="note">
            Hinweis: Das ist kein Checkout. Deine Anfrage wird an DVAYD gesendet und ihr vereinbart anschließend einen Termin.
          </div>
        </form>
      </div>
    </div>
  </div>

  <script>
    /* =========================
       DATA
       ========================= */
    const CATS = [
      { key:"zielgruppe", label:"Zielgruppe" },
      { key:"lektorat", label:"Korrektur / Lektorat" },
      { key:"cover", label:"Cover Design" },
      { key:"satz", label:"Satz (Layout)" },
      { key:"epub", label:"eBook-Konvertierung (ePUB)" },
      { key:"print", label:"Print-Veröffentlichung" },
      { key:"isbn", label:"ISBN" },
      { key:"distribution", label:"Distribution" },
      { key:"klappe", label:"Klappentext / Kurzvita" },
      { key:"marketing", label:"Marketing" },
      { key:"social", label:"Social Media / PR" },
      { key:"support", label:"Support" },
      { key:"rechte", label:"Rechte" },
    ];

    const OPTIONS = {
      zielgruppe: [
        { id:"ziel_starter", tier:"starter", name:"Debütautor:innen, schneller Start (eBook)", desc:"Schnell live gehen mit schlankem Setup.", price:0 },
        { id:"ziel_plus", tier:"plus", name:"Print + eBook, professionelle Veröffentlichung", desc:"Mehr Qualität & Kanäle.", price:0 },
        { id:"ziel_deluxe", tier:"deluxe", name:"Anspruchsvolle Projekte, Premium-Launch", desc:"Premium-Produktion & Setup.", price:0 },
        { id:"ziel_eutr", tier:"eutr", name:"EU + Türkei gleichzeitig veröffentlichen", desc:"Duale Distribution & Launch.", price:0 },
      ],
      lektorat: [
        { id:"lek_starter", tier:"starter", name:"Light-Korrektur (optional)", desc:"Basis-Check.", price:0 },
        { id:"lek_plus", tier:"plus", name:"Lektorat (stilistisch, 1–2 Runden)", desc:"Stil, Klarheit, Flow.", price:450 },
        { id:"lek_deluxe", tier:"deluxe", name:"Intensiv-Lektorat (mehrere Runden + Schlusskorrektur)", desc:"Mehrere Runden + Finish.", price:850 },
        { id:"lek_eutr", tier:"eutr", name:"— (separat zubuchbar)", desc:"Optional je nach Bedarf.", price:0 },
      ],
      cover: [
        { id:"cov_starter", tier:"starter", name:"Basic-Cover (Template)", desc:"Schnell & clean.", price:0 },
        { id:"cov_plus", tier:"plus", name:"Custom-Cover (Recherche + Entwürfe)", desc:"Individuell & zielgruppengerecht.", price:350 },
        { id:"cov_deluxe", tier:"deluxe", name:"Premium-Cover-Art (Illustration/Stock-Lizenz)", desc:"High-end Optik.", price:650 },
        { id:"cov_eutr", tier:"eutr", name:"Übernimmt gewähltes Cover (Starter/Plus/Deluxe)", desc:"Aus dem Basispaket.", price:0 },
      ],
      satz: [
        { id:"satz_starter", tier:"starter", name:"eBook-Satz (Standard)", desc:"Für eBook optimiert.", price:150 },
        { id:"satz_plus", tier:"plus", name:"Print + eBook-Satz", desc:"Druckreif + eBook.", price:300 },
        { id:"satz_deluxe", tier:"deluxe", name:"Print + eBook-Satz (inkl. Tabellen/Abbildungen)", desc:"Premium-Umfang.", price:450 },
        { id:"satz_eutr", tier:"eutr", name:"Übernimmt Satz (Starter/Plus/Deluxe)", desc:"Aus dem Basispaket.", price:0 },
      ],
      epub: [
        { id:"epub_starter", tier:"starter", name:"ePUB-Konvertierung", desc:"Upload-ready.", price:0 },
        { id:"epub_plus", tier:"plus", name:"ePUB-Konvertierung", desc:"Optimiert für mehrere Shops.", price:0 },
        { id:"epub_deluxe", tier:"deluxe", name:"ePUB-Konvertierung", desc:"Premium-Checks.", price:0 },
        { id:"epub_eutr", tier:"eutr", name:"ePUB-Konvertierung", desc:"Für duale Plattformen.", price:0 },
      ],
      print: [
        { id:"print_starter", tier:"starter", name:"— (optional zubuchbar)", desc:"Starter ist eBook-fokussiert.", price:0 },
        { id:"print_plus", tier:"plus", name:"Print Setup (KDP Print)", desc:"Paperback Setup + Upload-Support.", price:249 },
        { id:"print_deluxe", tier:"deluxe", name:"Print Setup (KDP Print)", desc:"Premium-Checks im Launch-Kontext.", price:249 },
        { id:"print_eutr", tier:"eutr", name:"Print (EU + TR Distribution)", desc:"Duale Print-Verfügbarkeit.", price:399 },
      ],
      isbn: [
        { id:"isbn_starter", tier:"starter", name:"KDP-ASIN (eBook) / ISBN optional", desc:"ISBN nicht zwingend nötig.", price:0 },
        { id:"isbn_plus", tier:"plus", name:"Wahlrecht: Eigen-ISBN oder Verlags-ISBN", desc:"Flexibel je nach Strategie.", price:99 },
        { id:"isbn_deluxe", tier:"deluxe", name:"Wahlrecht: Eigen-ISBN oder Verlags-ISBN", desc:"Premium-Setup.", price:99 },
        { id:"isbn_eutr", tier:"eutr", name:"Wahlrecht: Eigen-ISBN oder Verlags-ISBN", desc:"Duales Setup.", price:99 },
      ],
      distribution: [
        { id:"dist_starter", tier:"starter", name:"Amazon KDP (eBook)", desc:"Schneller KDP-Start.", price:0 },
        { id:"dist_plus", tier:"plus", name:"KDP + Aggregator (Tolino/Apple/Google)", desc:"Mehr Shops.", price:199 },
        { id:"dist_deluxe", tier:"deluxe", name:"KDP + Aggregator + Author Central Setup", desc:"Premium-Setup.", price:349 },
        { id:"dist_eutr", tier:"eutr", name:"Duale Distribution: EU + TR Shops/Plattformen", desc:"Zwei Märkte parallel.", price:499 },
      ],
      klappe: [
        { id:"kla_starter", tier:"starter", name:"—", desc:"Nicht enthalten (optional).", price:0 },
        { id:"kla_plus", tier:"plus", name:"Klappentext", desc:"Backcover + Shops.", price:150 },
        { id:"kla_deluxe", tier:"deluxe", name:"Klappentext + Kurzvita + Landing/Autorenseite", desc:"Premium-Texte & Assets.", price:350 },
        { id:"kla_eutr", tier:"eutr", name:"Anpassung Metadaten für TR/EU", desc:"Keywords/Shop-Texte dual.", price:250 },
      ],
      marketing: [
        { id:"mkt_starter", tier:"starter", name:"— (optional zubuchbar)", desc:"Basis ohne Ads.", price:0 },
        { id:"mkt_plus", tier:"plus", name:"Optional (Add-on)", desc:"Launch-Add-ons nach Bedarf.", price:199 },
        { id:"mkt_deluxe", tier:"deluxe", name:"Launch-Kampagne inkl. Reporting (Amazon/Meta)", desc:"Ads + Reporting.", price:499 },
        { id:"mkt_eutr", tier:"eutr", name:"Dualer Launch (TR + EU, ohne Übersetzung)", desc:"Duale Kampagne.", price:799 },
      ],
      social: [
        { id:"soc_starter", tier:"starter", name:"1 Basis-Post (optional)", desc:"Kleines Startsignal.", price:0 },
        { id:"soc_plus", tier:"plus", name:"Optional", desc:"Social/PR Add-ons.", price:149 },
        { id:"soc_deluxe", tier:"deluxe", name:"Kampagne + Report", desc:"Plan + Reporting.", price:299 },
        { id:"soc_eutr", tier:"eutr", name:"Social/PR für beide Märkte (Basis)", desc:"EU & TR Basics.", price:349 },
      ],
      support: [
        { id:"sup_starter", tier:"starter", name:"—", desc:"Support optional.", price:0 },
        { id:"sup_plus", tier:"plus", name:"Optional (Add-on)", desc:"Support nach Bedarf.", price:199 },
        { id:"sup_deluxe", tier:"deluxe", name:"Supportphase (z. B. 90 Tage nach Launch)", desc:"Begleitung nach Launch.", price:299 },
        { id:"sup_eutr", tier:"eutr", name:"Dual-Reporting zur Erstphase", desc:"Zwei Märkte begleiten.", price:399 },
      ],
      rechte: [
        { id:"recht_any", tier:"starter", name:"100% beim Autor", desc:"Du behältst alle Rechte.", price:0 },
      ]
    };

    const PRESETS = {
      starter: {
        zielgruppe: "ziel_starter",
        lektorat: "lek_starter",
        cover: "cov_starter",
        satz: "satz_starter",
        epub: "epub_starter",
        print: "print_starter",
        isbn: "isbn_starter",
        distribution: "dist_starter",
        klappe: "kla_starter",
        marketing: "mkt_starter",
        social: "soc_starter",
        support: "sup_starter",
        rechte: "recht_any"
      },
      plus: {
        zielgruppe: "ziel_plus",
        lektorat: "lek_plus",
        cover: "cov_plus",
        satz: "satz_plus",
        epub: "epub_plus",
        print: "print_plus",
        isbn: "isbn_plus",
        distribution: "dist_plus",
        klappe: "kla_plus",
        marketing: "mkt_plus",
        social: "soc_plus",
        support: "sup_plus",
        rechte: "recht_any"
      },
      deluxe: {
        zielgruppe: "ziel_deluxe",
        lektorat: "lek_deluxe",
        cover: "cov_deluxe",
        satz: "satz_deluxe",
        epub: "epub_deluxe",
        print: "print_deluxe",
        isbn: "isbn_deluxe",
        distribution: "dist_deluxe",
        klappe: "kla_deluxe",
        marketing: "mkt_deluxe",
        social: "soc_deluxe",
        support: "sup_deluxe",
        rechte: "recht_any"
      },
      eutr: {
        zielgruppe: "ziel_eutr",
        lektorat: "lek_eutr",
        cover: "cov_eutr",
        satz: "satz_eutr",
        epub: "epub_eutr",
        print: "print_eutr",
        isbn: "isbn_eutr",
        distribution: "dist_eutr",
        klappe: "kla_eutr",
        marketing: "mkt_eutr",
        social: "soc_eutr",
        support: "sup_eutr",
        rechte: "recht_any"
      }
    };

    /* =========================
       STATE + ELEMENTS
       ========================= */
    const selectedByCat = new Map();
    let activeCat = CATS[0].key;
    let openAccCat = activeCat; // <-- merkt, was im Mobile offen ist (oder null)


    const catListEl = document.getElementById("catList");
    const activeCatTitleEl = document.getElementById("activeCatTitle");
    const activeOptionsEl = document.getElementById("activeOptions");
    const summaryListEl = document.getElementById("summaryList");
    const emptyStateEl = document.getElementById("emptyState");
    const totalPriceEl = document.getElementById("totalPrice");

    const modal = document.getElementById("modal");
    const configField = document.getElementById("configField");
    const priceField = document.getElementById("priceField");

    function euro(n){ return `${Number(n||0)} €`; }

    function findOption(cat, id){
      return (OPTIONS[cat] || []).find(o => o.id === id);
    }

    function isMobileLayout(){
      return window.matchMedia("(max-width: 1020px)").matches;
    }

    function setActiveCat(cat){
  activeCat = cat;
  openAccCat = cat;   // <-- sorgt dafür, dass im Mobile die gleiche Kategorie offen ist
  renderCategories();
  renderActiveOptions();
  renderMobileAccordion();
}


    function selectOption(cat, optionId){
      const opt = findOption(cat, optionId);
      if(!opt) return;
      selectedByCat.set(cat, {cat, ...opt});
      renderActiveOptions();
      renderSummary();
      renderCategories();
      renderMobileAccordion();
    }

    function resetAll(){
      selectedByCat.clear();
      renderActiveOptions();
      renderSummary();
      renderCategories();
      renderMobileAccordion();
    }

    function setActivePkgVisual(pkg){
      document.querySelectorAll(".tab").forEach(t => {
        t.classList.toggle("active", t.dataset.pkg === pkg);
      });
      document.querySelectorAll(".ps-tab").forEach(t => {
        t.classList.toggle("active", t.dataset.pkg === pkg);
      });
    }

    function applyPreset(key){
      selectedByCat.clear();
      const preset = PRESETS[key] || PRESETS.starter;
      Object.keys(preset).forEach(cat => {
        const optId = preset[cat];
        const opt = findOption(cat, optId);
        if(opt) selectedByCat.set(cat, {cat, ...opt});
      });

      setActivePkgVisual(key);

      renderCategories();
      renderActiveOptions();
      renderSummary();
      renderMobileAccordion();
    }

    /* =========================
       RENDER (DESKTOP)
       ========================= */
    function renderCategories(){
      if(!catListEl) return;
      catListEl.innerHTML = "";
      CATS.forEach(c => {
        const btn = document.createElement("button");
        btn.type = "button";
        btn.className = "cat-btn" + (c.key === activeCat ? " active" : "");
        const chosen = selectedByCat.get(c.key);
        btn.innerHTML = `
          <span>${c.label}</span>
          <span class="cat-chip">${chosen ? "✓ gewählt" : "wählen"}</span>
        `;
        btn.addEventListener("click", () => setActiveCat(c.key));
        catListEl.appendChild(btn);
      });
    }

    function tierLabel(tier){
      if(tier==="starter") return "Starter";
      if(tier==="plus") return "Plus";
      if(tier==="deluxe") return "Deluxe";
      if(tier==="eutr") return "EU/TR";
      return tier;
    }

    function renderActiveOptions(){
      if(!activeOptionsEl) return;

      const catMeta = CATS.find(x => x.key === activeCat);
      if(activeCatTitleEl) activeCatTitleEl.textContent = catMeta ? catMeta.label : "Kategorie";

      const list = OPTIONS[activeCat] || [];
      const chosen = selectedByCat.get(activeCat)?.id;

      activeOptionsEl.innerHTML = "";
      list.forEach(opt => {
        const card = document.createElement("div");
        card.className = "opt" + (opt.id === chosen ? " selected" : "");
        card.setAttribute("role","button");
        card.setAttribute("tabindex","0");
        card.innerHTML = `
          <span class="tier ${opt.tier === "starter" ? "" : opt.tier}">${tierLabel(opt.tier)}</span>
          <div class="opt-title">${opt.name}</div>
          <div class="opt-desc">${opt.desc || ""}</div>
          <div class="opt-price">${euro(opt.price)}</div>
          <div class="check">✓</div>
        `;
        card.addEventListener("click", () => selectOption(activeCat, opt.id));
        card.addEventListener("keydown", (e) => {
          if(e.key==="Enter" || e.key===" "){ e.preventDefault(); selectOption(activeCat, opt.id); }
        });
        activeOptionsEl.appendChild(card);
      });
    }

    function renderSummary(){
      if(!summaryListEl) return;

      summaryListEl.innerHTML = "";
      let total = 0;

      const chosenCats = CATS.filter(c => selectedByCat.has(c.key)).map(c => c.key);

      if(chosenCats.length === 0){
        summaryListEl.appendChild(emptyStateEl);
        emptyStateEl.style.display = "block";
        totalPriceEl.textContent = "0 €";
        return;
      }
      emptyStateEl.style.display = "none";

      chosenCats.forEach(cat => {
        const it = selectedByCat.get(cat);
        total += Number(it.price || 0);

        const row = document.createElement("div");
        row.className = "sum-item";
        row.innerHTML = `
          <div class="sum-left">
            <div class="sum-cat">${CATS.find(c => c.key===cat)?.label || cat}</div>
            <div class="sum-name" title="${it.name}">${it.name}</div>
            <div class="sum-tier ${it.tier}">${tierLabel(it.tier)}</div>
          </div>
          <div class="sum-right">
            <div class="sum-price">${euro(it.price)}</div>
            <button class="sum-remove" type="button" data-cat="${cat}">Entfernen</button>
          </div>
        `;
        summaryListEl.appendChild(row);
      });

      totalPriceEl.textContent = euro(total);

      summaryListEl.querySelectorAll(".sum-remove").forEach(btn => {
        btn.addEventListener("click", () => {
          selectedByCat.delete(btn.dataset.cat);
          renderCategories();
          renderActiveOptions();
          renderSummary();
          renderMobileAccordion();
        });
      });
    }
    /* ======================
   MOBILE ACCORDION LOGIC
   ====================== */
const mobileAccordionEl = document.getElementById("mobileAccordion");

function isMobileLayout(){
  return window.matchMedia("(max-width: 1020px)").matches;
}

function openOnlyAccordion(catKey){
  if(!mobileAccordionEl) return;

  mobileAccordionEl.querySelectorAll(".acc").forEach(el => {
    const k = el.getAttribute("data-cat");
    if(catKey && k === catKey) el.classList.add("open");
    else el.classList.remove("open");
  });
}

function renderMobileAccordion(){
  if(!mobileAccordionEl) return;

  // nur in Mobile-Layout
  if(!isMobileLayout()){
    mobileAccordionEl.innerHTML = "";
    return;
  }

  mobileAccordionEl.innerHTML = "";

  CATS.forEach((c, idx) => {
    const chosen = selectedByCat.get(c.key);
    const chosenText = chosen ? chosen.name : "Noch nicht gewählt";

    const wrap = document.createElement("div");
    wrap.className = "acc" + (c.key === openAccCat ? " open" : "");
    wrap.setAttribute("data-cat", c.key);

    wrap.innerHTML = `
      <button class="acc-btn" type="button" aria-expanded="${c.key === openAccCat ? "true" : "false"}">
        <div class="acc-left">
          <div class="acc-title">${c.label}</div>
          <div class="acc-meta">
            <span class="acc-pill">${chosen ? "✓ gewählt" : "wählen"}</span>
            <span class="acc-chosen" title="${chosenText}">${chosenText}</span>
          </div>
        </div>
        <div class="acc-arrow">⌄</div>
      </button>

      <div class="acc-body">
        <div class="acc-inner">
          <div class="hintline">
            <span>Option auswählen</span>
            <span style="opacity:.8">1 Auswahl</span>
          </div>
          <div class="options" data-acc-options="${c.key}"></div>
        </div>
      </div>
    `;

    // TOGGLE: öffnen/schließen
    wrap.querySelector(".acc-btn").addEventListener("click", () => {
      if(openAccCat === c.key){
        openAccCat = null;           // <-- schließen
      } else {
        openAccCat = c.key;          // <-- öffnen
        activeCat = c.key;           // sync für Auswahl-Logik
      }
      renderMobileAccordion();
    });

    mobileAccordionEl.appendChild(wrap);

    // Optionen rendern
    const optHost = wrap.querySelector(`[data-acc-options="${c.key}"]`);
    const list = OPTIONS[c.key] || [];
    const chosenId = chosen?.id;

    optHost.innerHTML = "";
    list.forEach(opt => {
      const card = document.createElement("div");
      card.className = "opt" + (opt.id === chosenId ? " selected" : "");
      card.setAttribute("role","button");
      card.setAttribute("tabindex","0");
      card.innerHTML = `
        <span class="tier ${opt.tier === "starter" ? "" : opt.tier}">${tierLabel(opt.tier)}</span>
        <div class="opt-title">${opt.name}</div>
        <div class="opt-desc">${opt.desc || ""}</div>
        <div class="opt-price">${euro(opt.price)}</div>
        <div class="check">✓</div>
      `;

      card.addEventListener("click", () => {
        selectOption(c.key, opt.id);

        // optional: nach Auswahl automatisch nächste Kategorie öffnen
        const next = CATS[idx + 1]?.key;
        if(next){
          activeCat = next;
          openAccCat = next;
        } else {
          // letzte Kategorie: offen lassen oder schließen:
          // openAccCat = null;
        }

        renderCategories();
        renderActiveOptions();
        renderSummary();
        renderMobileAccordion();
      });

      card.addEventListener("keydown", (e) => {
        if(e.key==="Enter" || e.key===" "){ e.preventDefault(); card.click(); }
      });

      optHost.appendChild(card);
    });
  });

  openOnlyAccordion(openAccCat);
}

// bei Resize sauber neu rendern
window.addEventListener("resize", () => {
  renderMobileAccordion();
});



    /* =========================
       PACKAGE SWITCH (summary)
       ========================= */
    document.querySelectorAll(".ps-tab").forEach(tab => {
      tab.addEventListener("click", () => {
        const pkg = tab.dataset.pkg;
        applyPreset(pkg);
        renderChart(projectionForPackage(pkg), pkgLabelFromKey(pkg));
      });
    });

    /* =========================
   PACKAGE SWITCH (top tabs)
   ========================= */
document.querySelectorAll(".tab").forEach(tab => {
  tab.addEventListener("click", () => {
    const pkg = tab.dataset.pkg;
    applyPreset(pkg);
    renderChart(projectionForPackage(pkg), pkgLabelFromKey(pkg));
  });
});


    document.getElementById("resetBtnTop").addEventListener("click", () => {
      resetAll();
      applyPreset("starter");
      renderChart(projectionForPackage("starter"), pkgLabelFromKey("starter"));
    });
    document.getElementById("clearAllBtnTop").addEventListener("click", () => {
  resetAll(); // löscht wirklich alle Auswahl
  // optional: Chart auf neutral setzen (oder lassen)
  document.getElementById("chartTotal").textContent = "—";
});


    /* =========================
       CHART
       ========================= */
    function projectionForPackage(pkg){
      const profiles = {
        starter: { base: 2,  growth: 1.10, boost: 0.9 },
        plus:    { base: 4,  growth: 1.16, boost: 1.1 },
        deluxe:  { base: 6,  growth: 1.22, boost: 1.25 },
        eutr:    { base: 7,  growth: 1.26, boost: 1.35 },
      };
      const p = profiles[pkg] || profiles.starter;

      const arr = [];
      for(let m=1; m<=12; m++){
        const ramp = 1 - Math.exp(-m/3.2);
        const val  = (p.base + (Math.pow(p.growth, m) * 10 * p.boost)) * ramp;
        arr.push(Math.round(val));
      }
      return arr;
    }

    function renderChart(values, pkgLabel){
      const line = document.getElementById("line");
      const area = document.getElementById("area");
      const dots = document.getElementById("dots");
      const grid = document.getElementById("grid");

      const W = 900, H = 220;
      const padX = 28, padY = 18;
      const innerW = W - padX*2;
      const innerH = H - padY*2;

      dots.innerHTML = "";
      grid.innerHTML = "";

      const maxV = Math.max(...values, 1);
      const minV = 0;

      const lines = 4;
      for(let i=0; i<=lines; i++){
        const y = padY + (innerH * i/lines);
        const g = document.createElementNS("http://www.w3.org/2000/svg","line");
        g.setAttribute("x1", padX);
        g.setAttribute("x2", padX + innerW);
        g.setAttribute("y1", y);
        g.setAttribute("y2", y);
        g.setAttribute("stroke", "rgba(15,23,42,.08)");
        g.setAttribute("stroke-width", "1");
        grid.appendChild(g);
      }

      const pts = values.map((v, i) => {
        const x = padX + (innerW * (i/(values.length-1)));
        const y = padY + innerH - ((v - minV) / (maxV - minV || 1)) * innerH;
        return {x,y,v};
      });

      const d = pts.map((p, idx) => `${idx===0 ? "M" : "L"} ${p.x.toFixed(2)} ${p.y.toFixed(2)}`).join(" ");
      line.setAttribute("d", d);

      const areaD = `${d} L ${padX + innerW} ${padY + innerH} L ${padX} ${padY + innerH} Z`;
      area.setAttribute("d", areaD);

      pts.forEach((p, i) => {
        const c = document.createElementNS("http://www.w3.org/2000/svg","circle");
        c.setAttribute("cx", p.x);
        c.setAttribute("cy", p.y);
        c.setAttribute("r", i === pts.length-1 ? "5.2" : "3.8");
        c.setAttribute("fill", "rgba(37,99,235,.95)");
        c.setAttribute("stroke", "white");
        c.setAttribute("stroke-width", "2");
        dots.appendChild(c);
      });

      document.getElementById("chartPkg").textContent = pkgLabel;
      const total = values.reduce((a,b)=>a+b,0);
      document.getElementById("chartTotal").textContent = `${total} Verkäufe`;
    }

    function pkgLabelFromKey(key){
      if(key==="starter") return "Starter";
      if(key==="plus") return "Plus";
      if(key==="deluxe") return "Deluxe";
      if(key==="eutr") return "EU–TR Dual";
      return "Starter";
    }

    /* =========================
       INIT
       ========================= */
    renderCategories();
    renderActiveOptions();
    renderSummary();

    applyPreset("starter");
    renderChart(projectionForPackage("starter"), pkgLabelFromKey("starter"));

    renderMobileAccordion();

    window.addEventListener("resize", () => {
      renderMobileAccordion();
    });
  </script>

  <footer id="site-footer"></footer>
  <script>
(function(){
  const params = new URLSearchParams(location.search);
  const term = (params.get("hl") || "").trim();
  if (!term) return;

  // CSS für gelbes Highlight
  const style = document.createElement("style");
  style.textContent = `
    .hl-hit{
      background: #ffe600;
      color: #111;
      padding: 0 .12em;
      border-radius: .2em;
      box-shadow: 0 0 0 2px rgba(0,0,0,.08);
    }
    .hl-hit.is-main{
      outline: 2px solid rgba(255,230,0,.55);
    }
  `;
  document.head.appendChild(style);

  const esc = term.replace(/[.*+?^${}()|[\]\\]/g, "\\$&");
  const re = new RegExp(esc, "gi");

  // markiere Text in normalen Content-Bereichen (vermeidet Header/Nav)
  const root = document.querySelector("main") || document.body;

  const walker = document.createTreeWalker(root, NodeFilter.SHOW_TEXT, {
    acceptNode(node){
      const p = node.parentElement;
      if (!p) return NodeFilter.FILTER_REJECT;
      if (p.closest("script, style, noscript, header, nav, footer, form, input, textarea")) return NodeFilter.FILTER_REJECT;
      if (!node.nodeValue || !re.test(node.nodeValue)) return NodeFilter.FILTER_REJECT;
      re.lastIndex = 0;
      return NodeFilter.FILTER_ACCEPT;
    }
  });

  const hits = [];
  const textNodes = [];
  while (walker.nextNode()) textNodes.push(walker.currentNode);

  textNodes.forEach(node => {
    const text = node.nodeValue;
    const frag = document.createDocumentFragment();
    let last = 0;
    re.lastIndex = 0;
    let m;
    while ((m = re.exec(text)) !== null) {
      const start = m.index;
      const end = start + m[0].length;
      if (start > last) frag.appendChild(document.createTextNode(text.slice(last, start)));

      const span = document.createElement("mark");
      span.className = "hl-hit";
      span.textContent = text.slice(start, end);
      frag.appendChild(span);
      hits.push(span);

      last = end;
    }
    if (last < text.length) frag.appendChild(document.createTextNode(text.slice(last)));
    node.parentNode.replaceChild(frag, node);
  });

  // zum ersten Treffer scrollen + optisch hervorheben
  if (hits.length){
    hits[0].classList.add("is-main");
    hits[0].scrollIntoView({ behavior:"smooth", block:"center" });
  }
})();
</script>

</body>
</html>
